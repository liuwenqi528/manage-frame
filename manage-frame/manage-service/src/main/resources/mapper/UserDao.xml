<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.manage.frame.dao.UserDao">

    <sql id="userColumns">
        u.id as id,
        u.username as username,
        u.truename as truename,
        u.password as password,
        u.photo as photo,
        u.state as state,
        u.salt as salt
	</sql>
    <resultMap type="UserEntity" id="UserAndFile">
        <id property="id" column="id"/>
        <result property="username" column="username"/>
        <result property="truename" column="truename"/>
        <result property="password" column="password"/>
        <result property="photo" column="photo"/>
        <result property="state" column="state"/>
        <result property="salt" column="salt"/>
        <association property="fileEntity" column="{id = photo}" javaType="FileEntity" select="com.manage.frame.dao.FileDao.getOne"/>
    </resultMap>

    <!--登陆-->
    <select id="login" resultType="UserEntity">
        select
        <include refid="userColumns"/>
        from m_sys_user u
        where u.username = #{username}
    </select>

    <!--根据ID获取详情-->
    <select id="get"  resultType="UserEntity">
        select
        <include refid="userColumns"/>
        from m_sys_user u
        where u.id = #{id}
    </select>


    <select id="findByQuery" resultType="UserEntity">
        select
        <include refid="userColumns"/>
        from m_sys_user u
        <where>
            <if test="username != null and username !=''">
                and u.username like "%"+#{username}+"%"
            </if>
        </where>
        order by u.username
    </select>
    <select id="findAll" resultMap="UserAndFile">
        select
        <include refid="userColumns"/>
        from m_sys_user u
        order by u.username
    </select>


    <insert id="insert" parameterType="UserEntity">
       insert into m_sys_user
       (id ,username,password,truename,photo,salt,state)
       VALUES
       (#{id},#{username},#{password},#{truename},#{photo},#{salt},#{state})
    </insert>

    <update id="update">
        UPDATE m_sys_user SET
        <trim prefix="(" suffix=")" suffixOverrides=",">
            username = #{username},
            <if test="truename != null and truename !=''">
                truename = #{ truename},
            </if>
            <if test="photo != null and photo!=''">
                photo = #{photo},
            </if>
            password = #{password}   
        </trim>
        WHERE id = #{id}
    </update>

    <update id="delete">
		DELETE FROM m_sys_user
		WHERE id = #{id}
	</update>

</mapper>